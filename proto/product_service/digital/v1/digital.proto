syntax = "proto3";

package product_service.digital.v1;

import "google/protobuf/timestamp.proto";
import "google/protobuf/field_mask.proto";

option go_package = "github.com/mikhail5545/protos/gen/go/product_service/digital/v1;digitalpbv1";

enum AssetStatus{
  ASSET_STATUS_UNSPECIFIED = 0;
  ASSET_STATUS_DRAFT = 1;
  ASSET_STATUS_PUBLISHED = 2;
  ASSET_STATUS_ARCHIVED = 3;
}

message Asset{
  bytes uuid = 1;
  google.protobuf.Timestamp created_at = 2;
  google.protobuf.Timestamp updated_at = 3;
  optional google.protobuf.Timestamp deleted_at = 4;

  bytes variant_uuid = 5;
  optional bytes lesson_uuid = 6;

  string file_name = 7;
  int64 file_size = 8;
  string cloudinary_public_id = 9;
  string file_url = 10;
  string file_secure_url = 11;
  bytes media_service_id = 12;
  string mime_type = 13;
  AssetStatus status = 14;

  optional string note = 15;
  optional string archive_reason = 16;

  optional bytes created_by = 17;
  optional bytes published_by = 18;
  optional bytes archived_by = 19;
  optional string created_by_name = 20;
  optional string published_by_name = 21;
  optional string archived_by_name = 22;
}

message GetRequest{
  bytes uuid = 1;
}

message GetResponse{
  Asset asset = 1;
}

message GetWithDraftRequest{
  bytes uuid = 1;
}

message GetWithDraftResponse{
  Asset asset = 1;
}

message GetWithArchivedRequest{
  bytes uuid = 1;
}

message GetWithArchivedResponse{
  Asset asset = 1;
}

message ListRequest {
  repeated bytes uuids = 1;
  repeated bytes media_service_uuids = 2;
  repeated bytes variant_uuids = 3;
  repeated bytes lesson_uuids = 4;

  repeated string mime_types = 5;

  optional string order_by = 6;
  optional string order_dir = 7;

  int32 page_size = 8;
  string page_token = 9;
}

message ListResponse {
  repeated Asset assets = 1;
  string next_page_token = 2;
}

message ListDraftsRequest {
  repeated bytes uuids = 1;
  repeated bytes media_service_uuids = 2;
  repeated bytes variant_uuids = 3;
  repeated bytes lesson_uuids = 4;

  repeated string mime_types = 5;

  optional string order_by = 6;
  optional string order_dir = 7;

  int32 page_size = 8;
  string page_token = 9;
}

message ListDraftsResponse {
  repeated Asset assets = 1;
  string next_page_token = 2;
}

message ListArchivedRequest {
  repeated bytes uuids = 1;
  repeated bytes media_service_uuids = 2;
  repeated bytes variant_uuids = 3;
  repeated bytes lesson_uuids = 4;

  repeated string mime_types = 5;

  optional string order_by = 6;
  optional string order_dir = 7;

  int32 page_size = 8;
  string page_token = 9;
}

message ListArchivedResponse {
  repeated Asset assets = 1;
  string next_page_token = 2;
}

message CreateRequest{
  bytes variant_uuid = 1;
  string file_name = 2;
  int64 file_size = 3;
  string cloudinary_public_id = 4;
  string file_url = 5;
  string file_secure_url = 6;
  bytes media_service_id = 7;
  string mime_type = 8;
}

message CreateResponse{
  Asset asset = 1;
}

message UpdateRequest {
  bytes uuid = 1;
  optional string file_name = 2;
  optional int64 file_size = 3;
  optional string cloudinary_public_id = 4;
  optional string file_url = 5;
  optional string file_secure_url = 6;
  optional string mime_type = 7;
  google.protobuf.FieldMask updates = 8;
}

message UpdateResponse {
  bytes uuid = 1;
  optional string file_name = 2;
  optional int64 file_size = 3;
  optional string cloudinary_public_id = 4;
  optional string file_url = 5;
  optional string file_secure_url = 6;
  optional string mime_type = 7;
  google.protobuf.FieldMask updates = 8;
}

message PublishRequest {
  bytes uuid = 1;
  optional string note = 2;
  bytes admin_uuid = 3;
  string admin_name = 4;
}

message PublishResponse {}

message ArchiveRequest {
  bytes uuid = 1;
  optional string note = 2;
  bytes admin_uuid = 3;
  string admin_name = 4;
}

message ArchiveResponse {}

message RestoreRequest {
  bytes uuid = 1;
  optional string note = 2;
  bytes admin_uuid = 3;
  string admin_name = 4;
}

message RestoreResponse {}

message PingRequest {}

message PingResponse {
  int64 timestamp = 1;
}

service AssetService{
  rpc Ping(PingRequest) returns (PingResponse);
  rpc Get(GetRequest) returns (GetResponse);
  rpc GetWithDraft(GetWithDraftRequest) returns (GetWithDraftResponse);
  rpc GetWithArchived(GetWithArchivedRequest) returns (GetWithArchivedResponse);
  rpc List(ListRequest) returns (ListResponse);
  rpc ListDrafts(ListDraftsRequest) returns (ListDraftsResponse);
  rpc ListArchived(ListArchivedRequest) returns (ListArchivedResponse);
  rpc Create(CreateRequest) returns (CreateResponse);
  rpc Update(UpdateRequest) returns (UpdateResponse);
  rpc Publish(PublishRequest) returns (PublishResponse);
  rpc Archive(ArchiveRequest) returns (ArchiveResponse);
  rpc Restore(RestoreRequest) returns (RestoreResponse);
}