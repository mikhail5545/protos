syntax = "proto3";

package product_service.collection.v1;

import "google/protobuf/timestamp.proto";
import "google/protobuf/field_mask.proto";

option go_package = "github.com/mikhail5545/protos/gen/go/product_service/collection/v1;collectionpbv1";

message Rule{
  string field = 1;
  string relation = 2;
  string condition = 3;
}

message RuleSet{
  repeated Rule rules = 1;
  string match_type = 2;
}

enum CollectionStatus{
  COLLECTION_STATUS_UNSPECIFIED = 0;
  COLLECTION_STATUS_DRAFT = 1;
  COLLECTION_STATUS_ACTIVE = 2;
  COLLECTION_STATUS_ARCHIVED = 3;
}

message Collection{
  bytes uuid = 1;
  google.protobuf.Timestamp created_at = 2;
  google.protobuf.Timestamp updated_at = 3;
  optional google.protobuf.Timestamp deleted_at = 4;

  // The title of the collection.
  string title = 5;
  // URL-friendly identifier for the collection.
  string slug = 6;
  // A brief summary of the collection.
  optional string short_description = 7;
  // Detailed description of the collection.
  optional string description = 8;
  // Alias for an icon to be displayed in the UI.
  string icon_alias = 9;
  // True if products are added manually, false if rule-based.
  bool is_manual = 10;
  // The current status of the collection (e.g., draft, active).
  CollectionStatus status = 11;
  // The set of rules for an automated collection.
  RuleSet rule_set = 12;
  // Optional admin note about the collection/on the specific event.
  optional string note = 13;
  // Reason for archiving the collection.
  optional string archive_reason = 14;
  // User UUIDs stored as 16-byte binary values.
  optional bytes created_by = 15;
  optional bytes published_by = 16;
  optional bytes archived_by = 17;
  optional bytes restored_by = 18;
  // Denormalized user names for easier access.
  optional string created_by_name = 19;
  optional string published_by_name = 20;
  optional string archived_by_name = 21;
  optional string restored_by_name = 22;
}

message GetRequest {
  optional bytes uuid = 1;
  optional string slug = 2;
}

message GetResponse {
  Collection collection = 1;
}

message GetWithDraftRequest {
  optional bytes uuid = 1;
  optional string slug = 2;
}

message GetWithDraftResponse {
  Collection collection = 1;
}

message GetWithArchivedRequest {
  optional bytes uuid = 1;
  optional string slug = 2;
}

message GetWithArchivedResponse {
  Collection collection = 1;
}

message ListRequest{
  repeated bytes uuids = 1;
  repeated string slugs = 2;
  repeated bytes product_uuids = 3;
  optional bool is_manual = 4;
  optional string order_by = 5;
  optional string order_dir = 6;
  int32 page_size = 7;
  string page_token = 8;
}

message ListResponse{
  repeated Collection collections = 1;
  string next_page_token = 2;
}

message ListDraftsRequest{
  repeated bytes uuids = 1;
  repeated string slugs = 2;
  repeated bytes product_uuids = 3;
  optional bool is_manual = 4;
  optional string order_by = 5;
  optional string order_dir = 6;
  int32 page_size = 7;
  string page_token = 8;
}

message ListDraftsResponse{
  repeated Collection collections = 1;
  string next_page_token = 2;
}

message ListArchivedRequest{
  repeated bytes uuids = 1;
  repeated string slugs = 2;
  repeated bytes product_uuids = 3;
  optional bool is_manual = 4;
  optional string order_by = 5;
  optional string order_dir = 6;
  int32 page_size = 7;
  string page_token = 8;
}

message ListArchivedResponse{
  repeated Collection collections = 1;
  string next_page_token = 2;
}

message CreateRequest{
  string title = 1;
  string slug = 2;
  string short_description = 3;
  string icon_alias = 4;
  bool is_manual = 5;
  bytes admin_uuid = 6;
  string admin_name = 7;
  string note = 8;
}

message CreateResponse{
  Collection collection = 1;
}

message UpdateRequest{
  bytes uuid = 1;
  optional string title = 2;
  optional string slug = 3;
  bool regenerate_slug = 4;
  optional string short_description = 5;
  optional string description = 6;
  optional string icon_alias = 7;
  optional google.protobuf.FieldMask updates = 8;
}

message UpdateResponse{
  bytes uuid = 1;
  optional string title = 2;
  optional string slug = 3;
  optional string short_description = 4;
  optional string description = 5;
  optional string icon_alias = 6;
  optional google.protobuf.FieldMask updates = 7;
}

message PublishRequest{
  bytes uuid = 1;
  bytes admin_uuid = 2;
  string admin_name = 3;
  string note = 4;
}

message PublishResponse {}

message ArchiveRequest{
  bytes uuid = 1;
  bytes admin_uuid = 2;
  string admin_name = 3;
  string note = 4;
}

message ArchiveResponse {}

message RestoreRequest{
  bytes uuid = 1;
  bytes admin_uuid = 2;
  string admin_name = 3;
  string note = 4;
}

message RestoreResponse {}

message CreateOrUpdateRuleSetRequest{
  bytes uuid = 1;
  optional RuleSet rule_set = 2;
}

message CreateOrUpdateRuleSetResponse {}

message PingRequest {}

message PingResponse {
  int64 timestamp = 1;
}

service CollectionService{
  rpc Ping(PingRequest) returns (PingResponse);
  rpc Get(GetRequest) returns (GetResponse);
  rpc GetWithDraft(GetWithDraftRequest) returns (GetWithDraftResponse);
  rpc GetWithArchived(GetWithArchivedRequest) returns (GetWithArchivedResponse);
  rpc List(ListRequest) returns (ListResponse);
  rpc ListDrafts(ListDraftsRequest) returns (ListDraftsResponse);
  rpc ListArchived(ListArchivedRequest) returns (ListArchivedResponse);
  rpc Create(CreateRequest) returns (CreateResponse);
  rpc Update(UpdateRequest) returns (UpdateResponse);
  rpc Publish(PublishRequest) returns (PublishResponse);
  rpc Archive(ArchiveRequest) returns (ArchiveResponse);
  rpc Restore(RestoreRequest) returns (RestoreResponse);
  rpc CreateOrUpdateRuleSet(CreateOrUpdateRuleSetRequest) returns (CreateOrUpdateRuleSetResponse);
}