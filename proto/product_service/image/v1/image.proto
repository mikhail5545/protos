syntax = "proto3";

package product_service.image.v1;

import "google/protobuf/timestamp.proto";

option go_package = "github.com/mikhail5545/protos/gen/go/product_service/image/v1;imagepbv1";

enum ImageStatus{
  IMAGE_STATUS_UNSPECIFIED = 0;
  IMAGE_STATUS_ACTIVE = 1;
  IMAGE_STATUS_UPLOAD_URL_GENERATED = 2;
  IMAGE_STATUS_ARCHIVED = 3;
  IMAGE_STATUS_BROKEN = 4;
}

message Image{
  bytes uuid = 1;
  google.protobuf.Timestamp created_at = 2;
  google.protobuf.Timestamp updated_at = 3;

  ImageStatus status = 4;

  bytes media_service_uuid = 5;
  string url = 6;
  string secure_url = 7;
  string public_id = 8;
  string format = 9;
  string resource_type = 10;
  string folder = 11;
  string display_name = 12;
  optional int32 width = 13;
  optional int32 height = 14;
}

message BrokenImageRequest{
  bytes media_service_uuid = 1;
  string reason = 2;
  bytes admin_uuid = 3;
  string admin_name = 4;
}

message BrokenImageResponse {}

message DeleteRequest{
  bytes media_service_uuid = 1;
}

message DeleteResponse {}

message ForceDeleteRequest{
  bytes media_service_uuid = 1;
}

message ForceDeleteResponse {}

message ForceDeleteBatchRequest{
  repeated bytes media_service_uuids = 1;
}

message ForceDeleteBatchResponse {}

message PingRequest {}

message PingResponse {
  int64 timestamp = 1;
}

message UpdateRequest{
  bytes media_service_uuid = 1;
  optional ImageStatus image_status = 2;
  optional string url = 3;
  optional string secure_url = 4;
  optional string public_id = 5;
  optional string format = 6;
  optional string resource_type = 7;
  optional string folder = 8;
  optional string display_name = 9;
  optional int32 width = 10;
  optional int32 height = 11;
}

message UpdateResponse {}

service ImageService{
  rpc Ping(PingRequest) returns (PingResponse);
  rpc BrokenImage(BrokenImageRequest) returns (BrokenImageResponse);
  rpc Delete(DeleteRequest) returns (DeleteResponse);
  // ForceDelete permanently deletes an image and all its associated data. It should be used with caution in scenarios where data recovery is not possible through standard deletion methods.
  rpc ForceDelete(ForceDeleteRequest) returns (ForceDeleteResponse);
  // ForceDeleteBatch permanently deletes images and all associated data. It should be used with caution in scenarios where data recovery is not possible through standard deletion methods.
  rpc ForceDeleteBatch(ForceDeleteBatchRequest) returns (ForceDeleteBatchResponse);
  // Update is designed to be used only by internal services to modify video data, for example, on external storage provider webhooks.
  rpc Update(UpdateRequest) returns (UpdateResponse);
}