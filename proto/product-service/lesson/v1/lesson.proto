syntax = "proto3";

package lesson.v1;

import "product-service/lesson/lesson_video_version/v1/lesson_video_version.proto";
import "product-service/digital/v1/digital.proto";

import "google/protobuf/timestamp.proto";
import "google/protobuf/field_mask.proto";
import "google/protobuf/empty.proto";

option go_package = "github.com/mikhail5545/protos/gen/go/product-service/lesson/v1;lessonpbv1";

enum LessonStatus{
  STATUS_ACTIVE = 0;
  STATUS_DRAFT = 1;
  STATUS_ARCHIVED = 2;
}

message Lesson{
  bytes uuid = 1;
  google.protobuf.Timestamp created_at = 2;
  google.protobuf.Timestamp updated_at = 3;
  optional google.protobuf.Timestamp deleted_at = 4;

  bytes variant_uuid = 5;
  string title = 6;
  string slug = 7;
  int32 position = 8;
  string description = 9;
  bool is_preview = 10;
  LessonStatus status = 11;
  bool is_extra = 12;

  optional string note = 13;
  optional string archive_reason = 14;

  // Admin UUIDs
  optional bytes created_by = 15;
  optional bytes published_by = 16;
  optional bytes archived_by = 17;
  optional bytes restored_by = 18;

  // Denormalized Admin Names for quick access
  optional string created_by_name = 19;
  optional string published_by_name = 20;
  optional string archived_by_name = 21;
  optional string restored_by_name = 22;

  optional bytes latest_video_uuid = 23;
  optional lesson_video.v1.LessonVideoVersion latest_video = 24;
  repeated lesson_video.v1.LessonVideoVersion video_versions = 25;
  repeated digital.v1.Asset attachments = 26;
}

message GetRequest{
  optional bytes uuid = 1;
  optional string slug = 2;
}

message GetResponse{
  Lesson lesson = 1;
}

message ListRequest {
  repeated bytes uuids = 1;
  repeated bytes variant_uuids = 2;
  repeated string slugs = 3;
  repeated bytes product_uuids = 4;
  repeated bytes video_version_uuids = 5;

  optional bool is_preview = 6;
  optional bool is_extra = 7;

  optional string order_by = 8;
  optional string order_dir = 9;

  int32 page_size = 10;
  string page_token = 11;
}

message ListResponse {
  repeated Lesson lessons = 1;
  string next_page_token = 2;
}

message CreateRequest{
  bytes variant_uuid = 1;
  string title = 2;
  string slug = 3;
  int32 position = 4;
  bool is_preview = 5;
  bool is_extra = 6;

  bytes admin_uuid = 7;
  string admin_name = 8;
  string note = 9;
}

message CreateResponse{
  Lesson lesson = 1;
}

message UpdateRequest{
  bytes uuid = 1;
  bytes variant_uuid = 2;
  optional string title = 3;
  optional string slug = 4;
  bool regenerate_slug = 5;
  optional int32 position = 6;
  optional string description = 7;
  optional bool is_preview = 8;
  optional bool is_extra = 9;
  optional google.protobuf.FieldMask updates = 10;
}

message UpdateResponse{
  bytes uuid = 1;
  optional string title = 2;
  optional string slug = 3;
  optional int32 position = 4;
  optional string description = 5;
  optional bool is_preview = 6;
  optional bool is_extra = 7;
  optional google.protobuf.FieldMask updates = 8;
}

message ChangeStateRequest {
  bytes uuid = 1;
  optional string note = 2;
  bytes admin_uuid = 3;
  string admin_name = 4;
}

message PingResponse {
  int64 timestamp = 1;
}

service LessonService {
  rpc Ping(google.protobuf.Empty) returns (PingResponse);
  rpc Get(GetRequest) returns (GetResponse);
  rpc GetWithDraft(GetRequest) returns (GetResponse);
  rpc GetWithArchived(GetRequest) returns (GetResponse);
  rpc List(ListRequest) returns (ListResponse);
  rpc ListDrafts(ListRequest) returns (ListResponse);
  rpc ListArchived(ListRequest) returns (ListResponse);
  rpc Create(CreateRequest) returns (CreateResponse);
  rpc Update(UpdateRequest) returns (UpdateResponse);
  rpc Publish(ChangeStateRequest) returns (google.protobuf.Empty);
  rpc Archive(ChangeStateRequest) returns (google.protobuf.Empty);
  rpc Restore(ChangeStateRequest) returns (google.protobuf.Empty);
}